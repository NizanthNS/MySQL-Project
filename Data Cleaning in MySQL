Select * from layoffs;

-- 1. Remove Duplicates
-- 2. Standardize the Data
-- 3. Null values
-- 4. Remove Any Columns

Create Table layoffs_1
like layoffs;

Select * from layoffs_1;

Insert layoffs_1

Select * from layoffs_1;

-- 1. Remove Duplicates

Select *,
ROW_NUMBER() OVER(
PARTITION BY company, location, industry, total_laid_off, percentage_laid_off, 'date', stage, country, 
funds_raised_millions) AS Row_Num
from layoffs_1


With duplicate_CTE AS
(
Select *,
ROW_NUMBER() OVER(
PARTITION BY company, location, industry, total_laid_off, percentage_laid_off, 'date', stage, country, 
funds_raised_millions) AS Row_Num
from layoffs_1
)
Select *
From duplicate_CTE
Where Row_Num>1;


Select * from layoffs_1
Where company = "Casper";  -- Duplicate found


CREATE TABLE `layoffs_2` (
  `company` text,
  `location` text,
  `industry` text,
  `total_laid_off` int DEFAULT NULL,
  `percentage_laid_off` text,
  `date` text,
  `stage` text,
  `country` text,
  `funds_raised_millions` int DEFAULT NULL,
  `row_num` int
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;  

-- To delete duplicates created another table


Select * from layoffs_2;

Insert into layoffs_2
Select *,
ROW_NUMBER() OVER(
PARTITION BY company, location, industry, total_laid_off, percentage_laid_off, 'date', stage, country, 
funds_raised_millions) AS Row_Num
from layoffs_1;

Select * from layoffs_2
where row_num > 1;

Delete from layoffs_2
where row_num > 1;


-- 2. Standardizing the Data

Select DISTINCT(TRIM(Company))
From layoffs_2;

Select company, TRIM(Company) -- Compare both
From layoffs_2;

Update layoffs_2
SET company = TRIM(company);

Select industry
from layoffs_2;

Select DISTINCT industry
from layoffs_2;

Select DISTINCT industry
from layoffs_2
order by 1;

Select *
from layoffs_2
where industry like "Crypto%" ;

Update layoffs_2
Set industry = "Crypto"
where industry like "Crypto%";

Select DISTINCT industry
from layoffs_2;

Select DISTINCT Location
from layoffs_2;

Select DISTINCT Location
from layoffs_2
Order by 1;

Select DISTINCT Country
from layoffs_2
Order by 1;

Select DISTINCT Country
from layoffs_2
Where country like "United States%"
Order by 1;

Select DISTINCT Country, TRIM(TRAILING "." from country) -- To remove the DOT
from layoffs_2
Order by 1;

UPDATE layoffs_2
SET country = TRIM(TRAILING "." from country)
Where country like "United States%";

Select DISTINCT Country, TRIM(TRAILING "." from country)
from layoffs_2
Order by 1;

Select * from layoffs_2;

Select date from layoffs_2;

Select date, 
str_to_date(date, "%m/%d/%Y")
from layoffs_2;

Update layoffs_2
SET date = str_to_date(date, "%m/%d/%Y")

Alter table layoffs_2
modify column date date;


Select *
from layoffs_2
Where industry IS NULL
OR industry = '';

Select *
from layoffs_2
Where company = "Airbnb";


Select t1.industry, t2.industry
from layoffs_2 t1
Join layoffs_2 t2
	on t1.company = t2.company
Where (t1.industry IS NULL OR t1.industry = '')
AND t2.industry IS NOT NULL;


Update layoffs_2
SET industry = NULL
Where Industry = '';


Update layoffs_2 t1
Join layoffs_2 t2
	on t1.company = t2.company
SET t1.industry = t2.industry
Where (t1.industry IS NULL OR t1.industry = '')
AND t2.industry IS NOT NULL;


Select * from layoffs_2
where total_laid_off IS NULL
AND percentage_laid_off IS NULL;


Delete from layoffs_2
where total_laid_off IS NULL
AND percentage_laid_off IS NULL;


Alter table layoffs_2
Drop column row_num

Select * from layoffs_2
